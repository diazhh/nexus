<div class="ct-reels-container">
  <mat-toolbar class="mat-mdc-table-toolbar">
    <h2>CT Reels</h2>
    <span class="fill-space"></span>
    
    <!-- Search -->
    <mat-form-field class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput 
             placeholder="Search reels..." 
             [(ngModel)]="searchText"
             (keyup.enter)="onSearch(searchText)">
    </mat-form-field>
    
    <!-- Status Filter -->
    <mat-form-field class="filter-field">
      <mat-label>Status</mat-label>
      <mat-select [(ngModel)]="statusFilter" (selectionChange)="onStatusFilterChange($event.value)">
        <mat-option [value]="null">All</mat-option>
        <mat-option [value]="ReelStatus.AVAILABLE">Available</mat-option>
        <mat-option [value]="ReelStatus.IN_USE">In Use</mat-option>
        <mat-option [value]="ReelStatus.MAINTENANCE">Maintenance</mat-option>
        <mat-option [value]="ReelStatus.RETIRED">Retired</mat-option>
      </mat-select>
    </mat-form-field>
    
    <!-- Create Button -->
    <button mat-raised-button color="primary" (click)="createReel()">
      <mat-icon>add</mat-icon>
      New Reel
    </button>
  </mat-toolbar>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Table -->
  <div class="table-container" *ngIf="!isLoading">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2">
      
      <!-- Reel Code Column -->
      <ng-container matColumnDef="reelCode">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Reel Code</th>
        <td mat-cell *matCellDef="let reel">
          <strong>{{ reel.reelCode }}</strong>
        </td>
      </ng-container>

      <!-- Reel Name Column -->
      <ng-container matColumnDef="reelName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Reel Name</th>
        <td mat-cell *matCellDef="let reel">{{ reel.reelName }}</td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let reel">
          <span class="status-badge" [style.background-color]="getStatusColor(reel.status)">
            {{ getStatusLabel(reel.status) }}
          </span>
        </td>
      </ng-container>

      <!-- Material Grade Column -->
      <ng-container matColumnDef="materialGrade">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Material</th>
        <td mat-cell *matCellDef="let reel">
          <span class="material-badge">{{ reel.materialGrade }}</span>
        </td>
      </ng-container>

      <!-- Length Column -->
      <ng-container matColumnDef="totalLengthFt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Length</th>
        <td mat-cell *matCellDef="let reel">
          {{ reel.totalLengthFt?.toFixed(0) || '0' }} ft
        </td>
      </ng-container>

      <!-- Fatigue Column -->
      <ng-container matColumnDef="accumulatedFatiguePercent">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fatigue</th>
        <td mat-cell *matCellDef="let reel">
          <div class="fatigue-container">
            <div class="fatigue-bar">
              <div class="fatigue-fill" 
                   [class]="getFatigueClass(reel.accumulatedFatiguePercent || 0)"
                   [style.width.%]="reel.accumulatedFatiguePercent || 0">
              </div>
            </div>
            <span class="fatigue-text" [style.color]="getFatigueColor(reel.accumulatedFatiguePercent || 0)">
              {{ (reel.accumulatedFatiguePercent || 0).toFixed(1) }}%
            </span>
          </div>
        </td>
      </ng-container>

      <!-- Cycles Column -->
      <ng-container matColumnDef="totalCycles">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Cycles</th>
        <td mat-cell *matCellDef="let reel">
          {{ reel.totalCycles || 0 }}
        </td>
      </ng-container>

      <!-- Location Column -->
      <ng-container matColumnDef="currentLocation">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
        <td mat-cell *matCellDef="let reel">
          <mat-icon class="location-icon">location_on</mat-icon>
          {{ reel.currentLocation || 'N/A' }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let reel">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="viewDetails(reel)">
              <mat-icon>visibility</mat-icon>
              <span>View Details</span>
            </button>
            <button mat-menu-item (click)="viewFatigueHistory(reel)">
              <mat-icon>timeline</mat-icon>
              <span>Fatigue History</span>
            </button>
            <button mat-menu-item (click)="editReel(reel)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="deleteReel(reel)" class="delete-action">
              <mat-icon color="warn">delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
          class="clickable-row"
          (click)="viewDetails(row)"></tr>
    </table>

    <!-- Paginator -->
    <mat-paginator 
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 20, 50, 100]"
      (page)="onPageChange($event)">
    </mat-paginator>
  </div>
</div>
