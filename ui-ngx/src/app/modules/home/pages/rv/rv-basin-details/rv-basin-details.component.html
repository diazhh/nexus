<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div class="rv-details-full-container">
  <!-- Toolbar -->
  <mat-toolbar color="primary" class="details-toolbar">
    <button mat-icon-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <mat-icon class="toolbar-icon">terrain</mat-icon>
    <span class="toolbar-title">{{ basin?.name || 'Cargando...' }}</span>
    <span class="toolbar-spacer"></span>
    <button mat-icon-button (click)="editBasin()" *ngIf="basin" matTooltip="Editar Cuenca">
      <mat-icon>edit</mat-icon>
    </button>
  </mat-toolbar>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando datos de la cuenca...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && basin" class="details-content">

    <!-- Summary Cards -->
    <div class="summary-cards">
      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>location_on</mat-icon>
          <mat-card-title>Campos</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ fields.length }}</div>
          <div class="metric-unit">Total</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>layers</mat-icon>
          <mat-card-title>Yacimientos</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ statistics?.totalReservoirs || 0 }}</div>
          <div class="metric-unit">Total</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>build</mat-icon>
          <mat-card-title>Pozos</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ statistics?.totalWells || 0 }}</div>
          <div class="metric-unit">{{ statistics?.producingWells || 0 }} produciendo</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>map</mat-icon>
          <mat-card-title>Área</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ formatNumber(basin.areaKm2, 0) }}</div>
          <div class="metric-unit">km²</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Tabs with Content -->
    <mat-tab-group class="details-tabs">

      <!-- Tab 1: General Info -->
      <mat-tab label="General">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Información de la Cuenca</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-grid">
                <div class="info-item">
                  <label>Nombre</label>
                  <span>{{ basin.name }}</span>
                </div>
                <div class="info-item">
                  <label>Código</label>
                  <span>{{ basin.code || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Tipo de Cuenca</label>
                  <span>{{ basin.basinType || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>País</label>
                  <span>{{ basin.country || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Estado/Región</label>
                  <span>{{ basin.state || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Área</label>
                  <span>{{ formatNumber(basin.areaKm2, 0) }} km²</span>
                </div>
                <div class="info-item">
                  <label>Edad Geológica</label>
                  <span>{{ basin.geologicAge || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Ambiente Tectónico</label>
                  <span>{{ basin.tectonicSetting || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Sistema Petrolero</label>
                  <span>{{ basin.petroleumSystem || 'N/A' }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Tab 2: Fields -->
      <mat-tab label="Campos ({{ fields.length }})">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Lista de Campos</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <table mat-table [dataSource]="fields" class="compact-table" *ngIf="fields.length > 0">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Nombre</th>
                  <td mat-cell *matCellDef="let field">
                    <strong>{{ field.name }}</strong>
                  </td>
                </ng-container>

                <ng-container matColumnDef="code">
                  <th mat-header-cell *matHeaderCellDef>Código</th>
                  <td mat-cell *matCellDef="let field">{{ field.code || 'N/A' }}</td>
                </ng-container>

                <ng-container matColumnDef="operator">
                  <th mat-header-cell *matHeaderCellDef>Operador</th>
                  <td mat-cell *matCellDef="let field">{{ field.operatorName || 'N/A' }}</td>
                </ng-container>

                <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef>Tipo</th>
                  <td mat-cell *matCellDef="let field">{{ field.fieldType || 'N/A' }}</td>
                </ng-container>

                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Estado</th>
                  <td mat-cell *matCellDef="let field">
                    <span class="status-badge status-active">{{ field.fieldStatus || 'N/A' }}</span>
                  </td>
                </ng-container>

                <ng-container matColumnDef="location">
                  <th mat-header-cell *matHeaderCellDef>Ubicación</th>
                  <td mat-cell *matCellDef="let field">
                    {{ field.onshoreOffshore || 'N/A' }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['name', 'code', 'operator', 'type', 'status', 'location']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['name', 'code', 'operator', 'type', 'status', 'location'];"
                    class="clickable-row"
                    [routerLink]="['/rv/fields', row.assetId]"></tr>
              </table>

              <div *ngIf="fields.length === 0" class="empty-state">
                <mat-icon>location_off</mat-icon>
                <h3>No hay campos registrados</h3>
                <p>Esta cuenca aún no tiene campos asociados</p>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Tab 3: Statistics -->
      <mat-tab label="Estadísticas">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Estadísticas de la Cuenca</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-grid">
                <div class="info-item highlight">
                  <label>Total Campos</label>
                  <span>{{ fields.length }}</span>
                </div>
                <div class="info-item highlight">
                  <label>Total Yacimientos</label>
                  <span>{{ statistics?.totalReservoirs || 0 }}</span>
                </div>
                <div class="info-item highlight">
                  <label>Total Pozos</label>
                  <span>{{ statistics?.totalWells || 0 }}</span>
                </div>
                <div class="info-item">
                  <label>Pozos Produciendo</label>
                  <span>{{ statistics?.producingWells || 0 }}</span>
                </div>
                <div class="info-item">
                  <label>Pozos Inyectores</label>
                  <span>{{ statistics?.injectionWells || 0 }}</span>
                </div>
                <div class="info-item">
                  <label>Pozos Abandonados</label>
                  <span>{{ statistics?.abandonedWells || 0 }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

    </mat-tab-group>
  </div>
</div>

