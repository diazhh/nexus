<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div class="rv-details-container">
  <mat-toolbar color="primary" class="details-toolbar">
    <button mat-icon-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <mat-icon>location_on</mat-icon>
    <span class="toolbar-title">{{ field?.name || 'Cargando...' }}</span>
    <span class="toolbar-spacer"></span>
    <button mat-icon-button (click)="editField()" *ngIf="field">
      <mat-icon>edit</mat-icon>
    </button>
  </mat-toolbar>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="!isLoading && field" class="details-content">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>layers</mat-icon>
          <mat-card-title>Yacimientos</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ reservoirs.length }}</div>
          <div class="metric-unit">Total</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>build</mat-icon>
          <mat-card-title>Pozos</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ getTotalWells() }}</div>
          <div class="metric-unit">{{ getProducingWells() }} produciendo</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>oil_barrel</mat-icon>
          <mat-card-title>OOIP Total</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value">{{ formatNumber(getTotalOOIP(), 2) }}</div>
          <div class="metric-unit">MMbbl</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>place</mat-icon>
          <mat-card-title>Ubicación</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric-value" style="font-size: 18px;">{{ field.location || 'N/A' }}</div>
          <div class="metric-unit">País: {{ field.country || 'N/A' }}</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Tabs -->
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="details-tabs">
      <!-- General Tab -->
      <mat-tab label="General">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Información General</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-grid">
                <div class="info-item">
                  <label>Nombre:</label>
                  <span>{{ field.name }}</span>
                </div>
                <div class="info-item">
                  <label>Código:</label>
                  <span>{{ field.code || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Operador:</label>
                  <span>{{ field.operator || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Estado:</label>
                  <span class="status-badge">{{ field.status || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>País:</label>
                  <span>{{ field.country || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Ubicación:</label>
                  <span>{{ field.location || 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Latitud:</label>
                  <span>{{ field.latitude ? formatNumber(field.latitude, 6) : 'N/A' }}</span>
                </div>
                <div class="info-item">
                  <label>Longitud:</label>
                  <span>{{ field.longitude ? formatNumber(field.longitude, 6) : 'N/A' }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card>
            <mat-card-header>
              <mat-card-title>Estadísticas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-grid">
                <div class="info-item">
                  <label>Yacimientos:</label>
                  <span>{{ reservoirs.length }}</span>
                </div>
                <div class="info-item">
                  <label>Pozos Totales:</label>
                  <span>{{ getTotalWells() }}</span>
                </div>
                <div class="info-item">
                  <label>Pozos Produciendo:</label>
                  <span>{{ getProducingWells() }}</span>
                </div>
                <div class="info-item">
                  <label>OOIP Total:</label>
                  <span>{{ formatNumber(getTotalOOIP(), 2) }} MMbbl</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Reservoirs Tab -->
      <mat-tab label="Yacimientos">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Yacimientos del Campo ({{ reservoirs.length }})</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <table mat-table [dataSource]="reservoirs" class="compact-table" *ngIf="reservoirs.length > 0">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Nombre</th>
                  <td mat-cell *matCellDef="let reservoir">{{ reservoir.name }}</td>
                </ng-container>

                <ng-container matColumnDef="reservoirType">
                  <th mat-header-cell *matHeaderCellDef>Tipo</th>
                  <td mat-cell *matCellDef="let reservoir">{{ reservoir.reservoirType || 'N/A' }}</td>
                </ng-container>

                <ng-container matColumnDef="ooipEstimateMmbbl">
                  <th mat-header-cell *matHeaderCellDef>OOIP (MMbbl)</th>
                  <td mat-cell *matCellDef="let reservoir">{{ formatNumber(reservoir.ooipEstimateMmbbl, 2) }}</td>
                </ng-container>

                <ng-container matColumnDef="averageDepthFt">
                  <th mat-header-cell *matHeaderCellDef>Prof. Prom. (ft)</th>
                  <td mat-cell *matCellDef="let reservoir">{{ formatNumber(reservoir.averageDepthFt, 0) }}</td>
                </ng-container>

                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Estado</th>
                  <td mat-cell *matCellDef="let reservoir">
                    <span class="status-badge">{{ reservoir.status }}</span>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['name', 'reservoirType', 'ooipEstimateMmbbl', 'averageDepthFt', 'status']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['name', 'reservoirType', 'ooipEstimateMmbbl', 'averageDepthFt', 'status'];" class="clickable-row" [routerLink]="['/rv/reservoirs', row.assetId]"></tr>
              </table>
              <p *ngIf="reservoirs.length === 0" class="no-data">No hay yacimientos registrados para este campo</p>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Wells Tab -->
      <mat-tab label="Pozos">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Pozos del Campo ({{ wells.length }})</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <table mat-table [dataSource]="wells" class="compact-table" *ngIf="wells.length > 0">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Nombre</th>
                  <td mat-cell *matCellDef="let well">{{ well.name }}</td>
                </ng-container>

                <ng-container matColumnDef="wellType">
                  <th mat-header-cell *matHeaderCellDef>Tipo</th>
                  <td mat-cell *matCellDef="let well">{{ well.wellType }}</td>
                </ng-container>

                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Estado</th>
                  <td mat-cell *matCellDef="let well">
                    <span class="status-badge">{{ well.status }}</span>
                  </td>
                </ng-container>

                <ng-container matColumnDef="totalDepthMd">
                  <th mat-header-cell *matHeaderCellDef>TD MD (ft)</th>
                  <td mat-cell *matCellDef="let well">{{ formatNumber(well.totalDepthMd, 0) }}</td>
                </ng-container>

                <ng-container matColumnDef="spudDate">
                  <th mat-header-cell *matHeaderCellDef>Fecha Spud</th>
                  <td mat-cell *matCellDef="let well">{{ well.spudDate | date:'shortDate' }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['name', 'wellType', 'status', 'totalDepthMd', 'spudDate']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['name', 'wellType', 'status', 'totalDepthMd', 'spudDate'];" class="clickable-row" [routerLink]="['/rv/wells', row.assetId]"></tr>
              </table>
              <p *ngIf="wells.length === 0" class="no-data">No hay pozos registrados en este campo</p>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
