<!--

    Copyright Â© 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div class="pf-wells-list-container">
  <!-- Summary Cards -->
  <div class="summary-cards">
    <mat-card class="summary-card">
      <mat-card-content>
        <div class="stat-value">{{ fieldSummary.totalWells }}</div>
        <div class="stat-label">Total Wells</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="summary-card producing">
      <mat-card-content>
        <div class="stat-value">{{ fieldSummary.producingWells }}</div>
        <div class="stat-label">Producing</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="summary-card production">
      <mat-card-content>
        <div class="stat-value">{{ formatProduction(fieldSummary.totalProductionBpd) }}</div>
        <div class="stat-label">Total BPD</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="summary-card alarms" [class.has-alarms]="fieldSummary.activeAlarms > 0">
      <mat-card-content>
        <div class="stat-value">{{ fieldSummary.activeAlarms }}</div>
        <div class="stat-label">Active Alarms</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-row">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search wells</mat-label>
          <input matInput [formControl]="searchControl" placeholder="Well name or API number...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [value]="statusFilter" (selectionChange)="onStatusFilterChange($event.value)">
            <mat-option [value]="null">All Statuses</mat-option>
            <mat-option *ngFor="let status of [WellStatus.PRODUCING, WellStatus.SHUT_IN, WellStatus.UNDER_WORKOVER, WellStatus.INACTIVE]" [value]="status">
              {{ getStatusLabel(status) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Lift System</mat-label>
          <mat-select [value]="liftSystemFilter" (selectionChange)="onLiftSystemFilterChange($event.value)">
            <mat-option [value]="null">All Types</mat-option>
            <mat-option *ngFor="let type of [LiftSystemType.ESP, LiftSystemType.PCP, LiftSystemType.GAS_LIFT, LiftSystemType.ROD_PUMP, LiftSystemType.NATURAL_FLOW]" [value]="type">
              {{ getLiftSystemShortLabel(type) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-button color="primary" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Wells Table -->
  <mat-card class="table-card">
    <mat-card-content>
      <div class="table-container" [class.loading]="isLoading">
        <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>

        <table mat-table [dataSource]="dataSource" matSort class="wells-table">

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let well">
              <div class="status-indicator" [style.background-color]="getStatusColor(well.status)">
                <span class="status-text">{{ getStatusLabel(well.status) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Well Name</th>
            <td mat-cell *matCellDef="let well">
              <a class="well-name-link" (click)="viewWellDetails(well)">{{ well.name }}</a>
              <div class="api-number" *ngIf="well.apiNumber">{{ well.apiNumber }}</div>
            </td>
          </ng-container>

          <!-- Wellpad Column -->
          <ng-container matColumnDef="wellpadName">
            <th mat-header-cell *matHeaderCellDef>Wellpad</th>
            <td mat-cell *matCellDef="let well">{{ well.wellpadName || '-' }}</td>
          </ng-container>

          <!-- Lift System Column -->
          <ng-container matColumnDef="liftSystemType">
            <th mat-header-cell *matHeaderCellDef>Lift System</th>
            <td mat-cell *matCellDef="let well">
              <mat-chip class="lift-system-chip" [class]="well.liftSystemType.toLowerCase()">
                {{ getLiftSystemShortLabel(well.liftSystemType) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Production Column -->
          <ng-container matColumnDef="currentProductionBpd">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Production (BPD)</th>
            <td mat-cell *matCellDef="let well" class="production-cell">
              <span class="production-value">{{ formatProduction(well.currentProductionBpd) }}</span>
            </td>
          </ng-container>

          <!-- Alarms Column -->
          <ng-container matColumnDef="alarms">
            <th mat-header-cell *matHeaderCellDef>Alarms</th>
            <td mat-cell *matCellDef="let well">
              <button mat-icon-button
                      [color]="well.activeAlarmCount > 0 ? 'warn' : 'primary'"
                      [matBadge]="well.activeAlarmCount"
                      [matBadgeHidden]="!well.activeAlarmCount || well.activeAlarmCount === 0"
                      matBadgeColor="warn"
                      matBadgeSize="small"
                      (click)="viewWellAlarms(well)"
                      matTooltip="View alarms">
                <mat-icon>{{ well.activeAlarmCount > 0 ? 'warning' : 'check_circle' }}</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let well">
              <button mat-icon-button matTooltip="View Details" (click)="viewWellDetails(well)">
                <mat-icon>visibility</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
              [class.producing]="row.status === WellStatus.PRODUCING"
              (click)="viewWellDetails(row)">
          </tr>
        </table>

        <!-- Empty State -->
        <div *ngIf="!isLoading && dataSource.data.length === 0" class="empty-state">
          <mat-icon>oil_barrel</mat-icon>
          <p>No wells found</p>
          <p class="hint">Try adjusting your filters or search criteria</p>
        </div>
      </div>

      <mat-paginator
        [length]="totalElements"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="[10, 20, 50, 100]"
        (page)="onPageChange($event)"
        showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
